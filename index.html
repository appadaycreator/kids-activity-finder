<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>子供の習い事診断 - お子様にぴったりの習い事を見つけよう</title>
    <meta name="description" content="性格と興味から最適な習い事を診断。プログラミング、英会話、スポーツ、音楽など100種類以上から幅広くサポート">
    
    <!-- OGP Meta Tags -->
    <meta property="og:title" content="子供の習い事診断 - お子様にぴったりの習い事を見つけよう">
    <meta property="og:description" content="性格と興味から最適な習い事を診断。プログラミング、英会話、スポーツ、音楽など100種類以上から幅広くサポート">
    <meta property="og:image" content="https://cdn1.genspark.ai/user-upload-image/22_generated/1b2b567c-0e98-49ba-9ed5-13daec7598d5">
    <meta property="og:url" content="https://appadaycreator.github.io/kids-activity-finder/">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    
    <!-- External Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    
    <!-- PWA Meta -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoi5a2Q5L6b44Gu57+S44GE5LqL6Kit5pat44CCIiwic2hvcnRfbmFtZSI6Iue/kuOBhOS6i+ioo+aWrSIsImRlc2NyaXB0aW9uIjoi44GK5a2Q5qeY44Gr44G044Gj44Gf44KK44Gu57+S44GE5LqL44KS6KaL44Gk44GR44KI44GGIiwic3RhcnRfdXJsIjoiLyIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiNmOGZhZmMiLCJ0aGVtZV9jb2xvciI6IiM2MzY2ZjEifQ==">
    <meta name="theme-color" content="#6366f1">
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iOCIgZmlsbD0iIzYzNjZmMSIvPgo8cGF0aCBkPSJNOSAxMmg2djJIOXYtMnptMCA0aDEwdjJIOXYtMnptMCA0aDh2Mkg5di0yeiIgZmlsbD0id2hpdGUiLz4KPC9zdmc+">
    
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TXQGZRF9');</script>
    <!-- End Google Tag Manager -->
    
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        .progress-bar {
            transition: width 0.5s ease-in-out;
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .category-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .activity-card {
            transition: all 0.3s ease;
        }
        .activity-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TXQGZRF9"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <!-- Header -->
    <header class="gradient-bg text-white py-6">
        <div class="container mx-auto px-4">
            <h1 class="text-3xl font-bold text-center">
                <i class="fas fa-child mr-2"></i>
                子供の習い事診断
            </h1>
            <p class="text-center mt-2 text-lg opacity-90">お子様にぴったりの習い事を見つけよう（0歳〜18歳・100種類以上対応）</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Welcome Screen -->
        <div id="welcome-screen" class="max-w-2xl mx-auto animate-fade-in">
            <div class="bg-white rounded-xl card-shadow p-8 text-center">
                <img src="https://cdn1.genspark.ai/user-upload-image/22_generated/1b2b567c-0e98-49ba-9ed5-13daec7598d5" 
                     alt="子供の習い事のイメージ" class="w-full max-w-md mx-auto rounded-lg mb-6">
                
                <h2 class="text-2xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-star text-yellow-500 mr-2"></i>
                    お子様の可能性を発見しよう！
                </h2>
                <p class="text-gray-600 mb-6 text-lg">
                    性格分析と適性診断で、100種類以上の習い事からお子様にぴったりのものをご提案します。<br>
                    0歳から18歳まで、年齢に応じた最適な習い事が見つかります！
                </p>
                
                <div class="grid md:grid-cols-2 gap-6 mb-8">
                    <div class="text-center">
                        <i class="fas fa-bullseye text-4xl text-blue-500 mb-3"></i>
                        <h3 class="font-bold text-lg">100種類から適性マッチング</h3>
                        <p class="text-gray-600">豊富な選択肢から最適な習い事を提案</p>
                    </div>
                    <div class="text-center">
                        <i class="fas fa-chart-bar text-4xl text-green-500 mb-3"></i>
                        <h3 class="font-bold text-lg">カテゴリ別詳細レポート</h3>
                        <p class="text-gray-600">適性順のカテゴリから各TOP3を表示</p>
                    </div>
                </div>
                
                <p class="text-sm text-gray-500 mb-6">
                    <i class="fas fa-clock mr-1"></i>所要時間：約3分 | 
                    <i class="fas fa-save mr-1"></i>診断結果は保存されます
                </p>
                
                <button id="start-btn" class="btn-primary text-white py-4 px-8 rounded-full text-xl font-bold w-full">
                    <i class="fas fa-play mr-2"></i>診断をスタート
                </button>
            </div>
        </div>

        <!-- Progress Bar -->
        <div id="progress-container" class="max-w-2xl mx-auto mb-6 hidden">
            <div class="bg-white rounded-xl card-shadow p-4">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-medium text-gray-700">進捗状況</span>
                    <span id="progress-text" class="text-sm font-medium text-blue-600">1/6</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3">
                    <div id="progress-bar" class="progress-bar bg-blue-600 h-3 rounded-full" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Question Screen -->
        <div id="question-screen" class="max-w-2xl mx-auto hidden">
            <div class="bg-white rounded-xl card-shadow p-8">
                <h2 id="question-title" class="text-2xl font-bold text-gray-800 mb-6 text-center"></h2>
                <div id="question-content" class="space-y-4"></div>
                <div class="flex justify-between mt-8">
                    <button id="prev-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 py-3 px-6 rounded-lg font-medium hidden">
                        <i class="fas fa-arrow-left mr-2"></i>前に戻る
                    </button>
                    <button id="next-btn" class="btn-primary text-white py-3 px-6 rounded-lg font-medium ml-auto" disabled>
                        次へ進む<i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading Screen -->
        <div id="loading-screen" class="max-w-2xl mx-auto hidden">
            <div class="bg-white rounded-xl card-shadow p-8 text-center">
                <div class="loading-spinner mx-auto mb-4"></div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">診断結果を計算中...</h3>
                <p class="text-gray-600">100種類以上の習い事からお子様の適性を分析しています</p>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="max-w-6xl mx-auto hidden">
            <div class="bg-white rounded-xl card-shadow p-8">
                <h2 class="text-3xl font-bold text-center text-gray-800 mb-8">
                    <i class="fas fa-trophy text-yellow-500 mr-2"></i>
                    診断結果
                </h2>
                
                <!-- Personality Analysis -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-user-check mr-2"></i>性格分析結果
                    </h3>
                    <div id="personality-result" class="bg-blue-50 rounded-lg p-4"></div>
                </div>

                <!-- Chart -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-chart-radar mr-2"></i>適性チャート（カテゴリ別）
                    </h3>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <canvas id="aptitude-chart" width="400" height="200"></canvas>
                    </div>
                </div>

                <!-- Category-based Recommendations -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-medal mr-2"></i>カテゴリ別おすすめ習い事（適性順・各TOP3）
                    </h3>
                    <div id="category-recommendations"></div>
                </div>

                <!-- Action Buttons -->
                <div class="text-center space-y-4">
                    <div class="flex flex-wrap justify-center gap-4">
                        <button id="share-btn" class="bg-green-500 hover:bg-green-600 text-white py-3 px-6 rounded-lg font-medium">
                            <i class="fab fa-twitter mr-2"></i>結果をシェア
                        </button>
                        <button id="save-btn" class="bg-blue-500 hover:bg-blue-600 text-white py-3 px-6 rounded-lg font-medium">
                            <i class="fas fa-save mr-2"></i>結果を保存
                        </button>
                        <button id="compare-btn" class="bg-purple-500 hover:bg-purple-600 text-white py-3 px-6 rounded-lg font-medium">
                            <i class="fas fa-users mr-2"></i>友達と比較
                        </button>
                        <button id="retry-btn" class="bg-gray-500 hover:bg-gray-600 text-white py-3 px-6 rounded-lg font-medium">
                            <i class="fas fa-redo mr-2"></i>もう一度診断
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- History Screen -->
        <div id="history-screen" class="max-w-4xl mx-auto hidden">
            <div class="bg-white rounded-xl card-shadow p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-history mr-2"></i>診断履歴
                </h2>
                <div id="history-content"></div>
                <button id="back-to-result-btn" class="bg-blue-500 hover:bg-blue-600 text-white py-3 px-6 rounded-lg font-medium mt-6">
                    <i class="fas fa-arrow-left mr-2"></i>結果に戻る
                </button>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-100 py-8 mt-12">
        <div class="container mx-auto px-4">
            <div class="flex flex-wrap justify-center space-x-6 text-sm text-gray-600">
                <a href="privacy-policy.html" class="hover:text-blue-600">プライバシーポリシー</a>
                <a href="disclaimer.html" class="hover:text-blue-600">免責事項</a>
                <a href="contact.html" class="hover:text-blue-600">お問い合わせ</a>
            </div>
            <div class="text-center mt-4 text-sm text-gray-500">
                &copy; 2024 Kids Activity Finder. All rights reserved.
            </div>
        </div>
    </footer>

    <script>
        // Debug function
        function debugLog(message) {
            console.log('[習い事診断] ' + message);
        }

        // Application state
        var appState = {
            currentQuestion: 0,
            answers: {},
            result: null,
            startTime: null
        };

        // Questions data - updated to include 0-3 age range
        var questions = [
            {
                id: 'age',
                title: 'お子様の年齢を教えてください',
                type: 'radio',
                options: [
                    { value: '0-2', label: '0-2歳（赤ちゃん）' },
                    { value: '3-4', label: '3-4歳（幼稚園年少）' },
                    { value: '5-6', label: '5-6歳（幼稚園年中・年長）' },
                    { value: '7-9', label: '7-9歳（小学校低学年）' },
                    { value: '10-12', label: '10-12歳（小学校高学年）' },
                    { value: '13-15', label: '13-15歳（中学生）' },
                    { value: '16-18', label: '16-18歳（高校生）' }
                ]
            },
            {
                id: 'personality',
                title: 'お子様の性格に最も近いものは？',
                type: 'radio',
                options: [
                    { value: 'active', label: '活発で体を動かすのが好き' },
                    { value: 'creative', label: '創造的で芸術的なことが好き' },
                    { value: 'logical', label: '論理的で考えることが好き' },
                    { value: 'social', label: '社交的で人と話すのが好き' },
                    { value: 'quiet', label: '静かで集中して取り組むのが好き' },
                    { value: 'baby', label: '赤ちゃん（まだ判断できない）' }
                ]
            },
            {
                id: 'interests',
                title: 'お子様が最も興味を示すのは？',
                type: 'radio',
                options: [
                    { value: 'sports', label: 'スポーツ・運動' },
                    { value: 'art', label: '絵画・工作・音楽' },
                    { value: 'science', label: '実験・プログラミング・数学' },
                    { value: 'language', label: '読書・言語・コミュニケーション' },
                    { value: 'performance', label: '演技・ダンス・発表' },
                    { value: 'sensory', label: '感覚遊び・触れ合い（0-3歳向け）' }
                ]
            },
            {
                id: 'energy',
                title: 'お子様の体力レベルは？',
                type: 'radio',
                options: [
                    { value: 'high', label: 'とても高い（常に元気いっぱい）' },
                    { value: 'medium-high', label: '高い（活発に動き回る）' },
                    { value: 'medium', label: '普通（適度に活動する）' },
                    { value: 'medium-low', label: 'やや低い（ゆったりと過ごす）' },
                    { value: 'low', label: '低い（静かな活動を好む）' },
                    { value: 'baby', label: '赤ちゃん（まだ判断できない）' }
                ]
            },
            {
                id: 'budget',
                title: '月額予算はどれくらいですか？',
                type: 'radio',
                options: [
                    { value: 'low', label: '〜5,000円' },
                    { value: 'medium-low', label: '5,000円〜10,000円' },
                    { value: 'medium', label: '10,000円〜15,000円' },
                    { value: 'medium-high', label: '15,000円〜20,000円' },
                    { value: 'high', label: '20,000円以上' }
                ]
            },
            {
                id: 'transportation',
                title: '送迎について教えてください',
                type: 'radio',
                options: [
                    { value: 'easy', label: '平日・休日ともに送迎可能' },
                    { value: 'weekend', label: '休日のみ送迎可能' },
                    { value: 'near', label: '近所の教室なら送迎可能' },
                    { value: 'online', label: 'オンラインレッスン希望' },
                    { value: 'difficult', label: '送迎は困難' }
                ]
            }
        ];

        // Expanded activities database with 100+ activities
        var activities = {
            // 赤ちゃん・幼児向け (15種類)
            baby_swimming: {
                name: 'ベビースイミング',
                description: '親子で水に親しみ、運動機能の発達を促進',
                category: 'baby',
                icon: 'fas fa-baby',
                benefits: ['運動機能発達', '親子のスキンシップ', '免疫力向上', '感覚刺激'],
                cost: '月額6,000円〜10,000円',
                ageRange: '0歳〜3歳',
                timeCommitment: '週1回 30分',
                traits: ['baby', 'active']
            },
            baby_massage: {
                name: 'ベビーマッサージ',
                description: '親子のスキンシップと赤ちゃんの発育をサポート',
                category: 'baby',
                icon: 'fas fa-hands',
                benefits: ['親子絆深化', 'リラックス効果', '血行促進', '成長促進'],
                cost: '月額3,000円〜6,000円',
                ageRange: '0歳〜1歳',
                timeCommitment: '週1回 45分',
                traits: ['baby', 'quiet']
            },
            baby_english: {
                name: 'ベビー英語',
                description: '英語の音に慣れ親しみ、国際感覚を育む',
                category: 'baby',
                icon: 'fas fa-globe-americas',
                benefits: ['語学センス', '音感', '国際感覚', '親子時間'],
                cost: '月額5,000円〜8,000円',
                ageRange: '0歳〜3歳',
                timeCommitment: '週1回 30分',
                traits: ['baby', 'social']
            },
            baby_yoga: {
                name: 'ベビーヨガ',
                description: '親子でヨガポーズを楽しみ、心身の健康を促進',
                category: 'baby',
                icon: 'fas fa-lotus',
                benefits: ['柔軟性', '親子絆', 'リラックス', '体幹強化'],
                cost: '月額4,000円〜7,000円',
                ageRange: '0歳〜2歳',
                timeCommitment: '週1回 45分',
                traits: ['baby', 'quiet']
            },
            baby_music: {
                name: 'ベビーリトミック',
                description: '音楽に合わせて体を動かし、リズム感を育む',
                category: 'baby',
                icon: 'fas fa-music',
                benefits: ['リズム感', '音感', '表現力', '社会性'],
                cost: '月額4,000円〜8,000円',
                ageRange: '0歳〜3歳',
                timeCommitment: '週1回 45分',
                traits: ['baby', 'creative']
            },
            toddler_gymnastics: {
                name: '幼児体操',
                description: '基本的な運動能力と体力を楽しく身につける',
                category: 'baby',
                icon: 'fas fa-child',
                benefits: ['基礎体力', 'バランス感覚', '協調性', '自信'],
                cost: '月額6,000円〜10,000円',
                ageRange: '1歳〜4歳',
                timeCommitment: '週1回 45分',
                traits: ['baby', 'active']
            },
            sensory_play: {
                name: '感覚遊び教室',
                description: '五感を刺激する遊びで脳の発達を促進',
                category: 'baby',
                icon: 'fas fa-hand-paper',
                benefits: ['感覚発達', '脳の発達', '創造力', '探究心'],
                cost: '月額4,000円〜7,000円',
                ageRange: '0歳〜3歳',
                timeCommitment: '週1回 60分',
                traits: ['baby', 'creative']
            },
            parent_child_cooking: {
                name: '親子クッキング',
                description: '親子で料理を楽しみ、食育と創造力を育む',
                category: 'baby',
                icon: 'fas fa-cookie-bite',
                benefits: ['食育', '親子時間', '創造力', '達成感'],
                cost: '月額3,000円〜6,000円',
                ageRange: '2歳〜6歳',
                timeCommitment: '月2回 90分',
                traits: ['baby', 'creative']
            },

            // スポーツ・運動系 (25種類)
            soccer: {
                name: 'サッカー',
                description: 'チームワークと協調性を育むスポーツの王様',
                category: 'sports',
                icon: 'fas fa-futbol',
                benefits: ['チームワーク', '持久力向上', '協調性', '戦略的思考'],
                cost: '月額6,000円〜12,000円',
                ageRange: '3歳〜18歳',
                timeCommitment: '週2回 90分',
                traits: ['active', 'social']
            },
            swimming: {
                name: '水泳',
                description: '全身運動で健康的な体作りを目指す',
                category: 'sports',
                icon: 'fas fa-swimmer',
                benefits: ['全身運動', '持久力向上', '姿勢改善', '心肺機能向上'],
                cost: '月額8,000円〜15,000円',
                ageRange: '3歳〜18歳',
                timeCommitment: '週2回 60分',
                traits: ['active', 'quiet']
            },
            baseball: {
                name: '野球',
                description: '集中力と反射神経を鍛える人気スポーツ',
                category: 'sports',
                icon: 'fas fa-baseball-ball',
                benefits: ['反射神経', '集中力', 'チームワーク', '戦術理解'],
                cost: '月額5,000円〜10,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週2回 120分',
                traits: ['active', 'logical']
            },
            tennis: {
                name: 'テニス',
                description: '個人技術と戦略性を磨くスポーツ',
                category: 'sports',
                icon: 'fas fa-table-tennis',
                benefits: ['反射神経', '戦略的思考', '集中力', '持久力'],
                cost: '月額8,000円〜20,000円',
                ageRange: '5歳〜18歳',
                timeCommitment: '週1回 60分',
                traits: ['active', 'logical']
            },
            basketball: {
                name: 'バスケットボール',
                description: 'スピードと判断力を養うチームスポーツ',
                category: 'sports',
                icon: 'fas fa-basketball-ball',
                benefits: ['瞬発力', '判断力', 'チームワーク', '身長促進'],
                cost: '月額5,000円〜10,000円',
                ageRange: '8歳〜18歳',
                timeCommitment: '週2回 90分',
                traits: ['active', 'social']
            },
            volleyball: {
                name: 'バレーボール',
                description: 'チームプレイと反射神経を鍛える',
                category: 'sports',
                icon: 'fas fa-volleyball-ball',
                benefits: ['反射神経', 'チームワーク', 'ジャンプ力', '協調性'],
                cost: '月額4,000円〜8,000円',
                ageRange: '10歳〜18歳',
                timeCommitment: '週2回 90分',
                traits: ['active', 'social']
            },
            gymnastics: {
                name: '体操',
                description: '柔軟性とバランス感覚を育む基礎運動',
                category: 'sports',
                icon: 'fas fa-running',
                benefits: ['柔軟性', 'バランス感覚', '筋力向上', '集中力'],
                cost: '月額6,000円〜15,000円',
                ageRange: '3歳〜18歳',
                timeCommitment: '週1回 60分',
                traits: ['active', 'quiet']
            },
            track_field: {
                name: '陸上競技',
                description: '走る・跳ぶ・投げるの基本動作を鍛える',
                category: 'sports',
                icon: 'fas fa-running',
                benefits: ['基礎体力', '持久力', '瞬発力', '目標達成力'],
                cost: '月額3,000円〜8,000円',
                ageRange: '8歳〜18歳',
                timeCommitment: '週2回 90分',
                traits: ['active', 'logical']
            },
            badminton: {
                name: 'バドミントン',
                description: '反射神経と戦略性を磨くラケットスポーツ',
                category: 'sports',
                icon: 'fas fa-shuttlecock',
                benefits: ['反射神経', '戦略的思考', '集中力', '持久力'],
                cost: '月額4,000円〜10,000円',
                ageRange: '8歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['active', 'logical']
            },
            golf: {
                name: 'ゴルフ',
                description: '集中力と技術を磨く紳士のスポーツ',
                category: 'sports',
                icon: 'fas fa-golf-ball',
                benefits: ['集中力', '精密性', '忍耐力', '礼儀作法'],
                cost: '月額15,000円〜30,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 60分',
                traits: ['quiet', 'logical']
            },
            rugby: {
                name: 'ラグビー',
                description: 'フィジカルとメンタルを鍛える激しいスポーツ',
                category: 'sports',
                icon: 'fas fa-football-ball',
                benefits: ['フィジカル強化', 'チームワーク', '勇気', '戦略性'],
                cost: '月額5,000円〜10,000円',
                ageRange: '10歳〜18歳',
                timeCommitment: '週2回 120分',
                traits: ['active', 'social']
            },
            cycling: {
                name: 'サイクリング',
                description: '持久力と下半身を鍛える有酸素運動',
                category: 'sports',
                icon: 'fas fa-bicycle',
                benefits: ['持久力', '下半身強化', '心肺機能', '冒険心'],
                cost: '月額3,000円〜8,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['active', 'quiet']
            },
            skateboarding: {
                name: 'スケートボード',
                description: 'バランス感覚と創造性を育むストリートスポーツ',
                category: 'sports',
                icon: 'fas fa-skating',
                benefits: ['バランス感覚', '創造性', '集中力', '個性表現'],
                cost: '月額6,000円〜12,000円',
                ageRange: '8歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['active', 'creative']
            },
            surfing: {
                name: 'サーフィン',
                description: '自然と一体になりバランス感覚を鍛える',
                category: 'sports',
                icon: 'fas fa-swimmer',
                benefits: ['バランス感覚', '自然との調和', '集中力', '冒険心'],
                cost: '月額10,000円〜20,000円',
                ageRange: '10歳〜18歳',
                timeCommitment: '週1回 120分',
                traits: ['active', 'creative']
            },
            rock_climbing: {
                name: 'ボルダリング・クライミング',
                description: '全身の筋力と問題解決能力を鍛える',
                category: 'sports',
                icon: 'fas fa-mountain',
                benefits: ['全身筋力', '問題解決力', '集中力', '達成感'],
                cost: '月額8,000円〜15,000円',
                ageRange: '8歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['active', 'logical']
            },
            archery: {
                name: 'アーチェリー',
                description: '集中力と精密性を極める射撃スポーツ',
                category: 'sports',
                icon: 'fas fa-bullseye',
                benefits: ['集中力', '精密性', '忍耐力', '精神統一'],
                cost: '月額6,000円〜12,000円',
                ageRange: '10歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['quiet', 'logical']
            },
            horseback_riding: {
                name: '乗馬',
                description: '動物との触れ合いとバランス感覚を育む',
                category: 'sports',
                icon: 'fas fa-horse',
                benefits: ['バランス感覚', '動物愛護', '責任感', '自然との調和'],
                cost: '月額20,000円〜40,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 60分',
                traits: ['active', 'quiet']
            },
            table_tennis: {
                name: '卓球',
                description: '反射神経と集中力を鍛える室内スポーツ',
                category: 'sports',
                icon: 'fas fa-table-tennis',
                benefits: ['反射神経', '集中力', '戦略性', '持久力'],
                cost: '月額4,000円〜8,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週2回 90分',
                traits: ['active', 'logical']
            },
            bowling: {
                name: 'ボウリング',
                description: '正確性とコントロールを学ぶレジャースポーツ',
                category: 'sports',
                icon: 'fas fa-bowling-ball',
                benefits: ['正確性', 'コントロール', '集中力', '忍耐力'],
                cost: '月額4,000円〜8,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['quiet', 'logical']
            },
            ice_skating: {
                name: 'アイススケート',
                description: '氷上でバランス感覚と表現力を育む',
                category: 'sports',
                icon: 'fas fa-skating',
                benefits: ['バランス感覚', '表現力', '柔軟性', '芸術性'],
                cost: '月額8,000円〜20,000円',
                ageRange: '4歳〜18歳',
                timeCommitment: '週1回 60分',
                traits: ['active', 'creative']
            },
            skiing: {
                name: 'スキー',
                description: '雪山でバランス感覚とスピード感を楽しむ',
                category: 'sports',
                icon: 'fas fa-skiing',
                benefits: ['バランス感覚', 'スピード感', '冒険心', '自然体験'],
                cost: '月額15,000円〜30,000円',
                ageRange: '4歳〜18歳',
                timeCommitment: '月2回 1日',
                traits: ['active', 'creative']
            },

            // 武道系 (8種類)
            judo: {
                name: '柔道',
                description: '礼儀と精神力を鍛える日本の武道',
                category: 'martial_arts',
                icon: 'fas fa-fist-raised',
                benefits: ['礼儀作法', '精神力', '体幹強化', '護身術'],
                cost: '月額5,000円〜10,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週2回 90分',
                traits: ['active', 'quiet']
            },
            kendo: {
                name: '剣道',
                description: '日本古来の武道で心身を鍛える',
                category: 'martial_arts',
                icon: 'fas fa-sword',
                benefits: ['礼儀作法', '集中力', '精神力', '正しい姿勢'],
                cost: '月額4,000円〜8,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週2回 90分',
                traits: ['active', 'quiet']
            },
            karate: {
                name: '空手',
                description: '護身術と精神鍛錬を学ぶ武道',
                category: 'martial_arts',
                icon: 'fas fa-hand-rock',
                benefits: ['護身術', '精神力', '体力向上', '礼儀作法'],
                cost: '月額5,000円〜10,000円',
                ageRange: '4歳〜18歳',
                timeCommitment: '週2回 90分',
                traits: ['active', 'quiet']
            },
            aikido: {
                name: '合気道',
                description: '相手の力を利用する平和的な武道',
                category: 'martial_arts',
                icon: 'fas fa-yin-yang',
                benefits: ['精神統一', '護身術', '柔軟性', '平和思想'],
                cost: '月額5,000円〜10,000円',
                ageRange: '8歳〜18歳',
                timeCommitment: '週2回 90分',
                traits: ['quiet', 'logical']
            },
            taekwondo: {
                name: 'テコンドー',
                description: '足技を中心とした韓国の武道',
                category: 'martial_arts',
                icon: 'fas fa-fist-raised',
                benefits: ['柔軟性', '足技', '精神力', '国際性'],
                cost: '月額6,000円〜12,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週2回 90分',
                traits: ['active', 'social']
            },
            boxing: {
                name: 'ボクシング',
                description: '体力と精神力を鍛える格闘技',
                category: 'martial_arts',
                icon: 'fas fa-fist-raised',
                benefits: ['体力向上', '精神力', 'ストレス発散', '自信'],
                cost: '月額8,000円〜15,000円',
                ageRange: '10歳〜18歳',
                timeCommitment: '週2回 90分',
                traits: ['active', 'logical']
            },
            kyudo: {
                name: '弓道',
                description: '日本の弓術で精神統一と集中力を鍛える',
                category: 'martial_arts',
                icon: 'fas fa-bullseye',
                benefits: ['精神統一', '集中力', '正しい姿勢', '礼儀作法'],
                cost: '月額4,000円〜8,000円',
                ageRange: '12歳〜18歳',
                timeCommitment: '週2回 90分',
                traits: ['quiet', 'logical']
            },
            fencing: {
                name: 'フェンシング',
                description: '西洋剣術で反射神経と戦略性を磨く',
                category: 'martial_arts',
                icon: 'fas fa-sword',
                benefits: ['反射神経', '戦略性', '集中力', '国際性'],
                cost: '月額10,000円〜20,000円',
                ageRange: '8歳〜18歳',
                timeCommitment: '週2回 90分',
                traits: ['active', 'logical']
            },

            // 音楽系 (20種類)
            piano: {
                name: 'ピアノ',
                description: '指先の器用さと音感を育む楽器の王様',
                category: 'music',
                icon: 'fas fa-piano',
                benefits: ['音感', '指先の器用さ', '集中力', '表現力'],
                cost: '月額8,000円〜20,000円',
                ageRange: '3歳〜18歳',
                timeCommitment: '週1回 30分',
                traits: ['creative', 'quiet']
            },
            violin: {
                name: 'バイオリン',
                description: '美しい音色で感情表現を学ぶ弦楽器',
                category: 'music',
                icon: 'fas fa-violin',
                benefits: ['音感', '姿勢改善', '集中力', '表現力'],
                cost: '月額10,000円〜25,000円',
                ageRange: '4歳〜18歳',
                timeCommitment: '週1回 30分',
                traits: ['creative', 'quiet']
            },
            guitar: {
                name: 'ギター',
                description: '幅広いジャンルで活躍する人気楽器',
                category: 'music',
                icon: 'fas fa-guitar',
                benefits: ['音感', '指先の器用さ', '創造力', '自己表現'],
                cost: '月額6,000円〜15,000円',
                ageRange: '8歳〜18歳',
                timeCommitment: '週1回 45分',
                traits: ['creative', 'social']
            },
            drums: {
                name: 'ドラム',
                description: 'リズム感と全身の協調性を鍛える',
                category: 'music',
                icon: 'fas fa-drum',
                benefits: ['リズム感', '協調性', 'ストレス発散', '集中力'],
                cost: '月額8,000円〜15,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 45分',
                traits: ['active', 'creative']
            },
            flute: {
                name: 'フルート',
                description: '美しい音色と正しい呼吸法を学ぶ',
                category: 'music',
                icon: 'fas fa-music',
                benefits: ['呼吸法', '音感', '集中力', '姿勢改善'],
                cost: '月額8,000円〜18,000円',
                ageRange: '8歳〜18歳',
                timeCommitment: '週1回 30分',
                traits: ['creative', 'quiet']
            },
            trumpet: {
                name: 'トランペット',
                description: '力強い音色で表現力を育む金管楽器',
                category: 'music',
                icon: 'fas fa-trumpet',
                benefits: ['肺活量', '音感', '表現力', '集中力'],
                cost: '月額8,000円〜18,000円',
                ageRange: '10歳〜18歳',
                timeCommitment: '週1回 45分',
                traits: ['creative', 'social']
            },
            saxophone: {
                name: 'サックス',
                description: 'ジャズからクラシックまで幅広く活躍',
                category: 'music',
                icon: 'fas fa-saxophone',
                benefits: ['肺活量', '音感', '表現力', 'ジャズ感覚'],
                cost: '月額10,000円〜20,000円',
                ageRange: '12歳〜18歳',
                timeCommitment: '週1回 45分',
                traits: ['creative', 'social']
            },
            cello: {
                name: 'チェロ',
                description: '深い音色で心の豊かさを育む大型弦楽器',
                category: 'music',
                icon: 'fas fa-cello',
                benefits: ['音感', '姿勢改善', '表現力', '集中力'],
                cost: '月額12,000円〜25,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 45分',
                traits: ['creative', 'quiet']
            },
            clarinet: {
                name: 'クラリネット',
                description: '柔らかな音色が魅力的な木管楽器',
                category: 'music',
                icon: 'fas fa-clarinet',
                benefits: ['呼吸法', '音感', '集中力', '表現力'],
                cost: '月額8,000円〜18,000円',
                ageRange: '10歳〜18歳',
                timeCommitment: '週1回 45分',
                traits: ['creative', 'quiet']
            },
            voice_training: {
                name: '声楽・ボイストレーニング',
                description: '美しい歌声と正しい発声を学ぶ',
                category: 'music',
                icon: 'fas fa-microphone',
                benefits: ['発声法', '表現力', '自信向上', '肺活量'],
                cost: '月額6,000円〜15,000円',
                ageRange: '5歳〜18歳',
                timeCommitment: '週1回 45分',
                traits: ['creative', 'social']
            },
            ukulele: {
                name: 'ウクレレ',
                description: '気軽に始められる小さなギター',
                category: 'music',
                icon: 'fas fa-guitar',
                benefits: ['音感', '手軽さ', '創造力', 'リラックス'],
                cost: '月額4,000円〜10,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 45分',
                traits: ['creative', 'quiet']
            },
            harp: {
                name: 'ハープ',
                description: '天使の楽器と呼ばれる美しい弦楽器',
                category: 'music',
                icon: 'fas fa-harp',
                benefits: ['音感', '優雅さ', '集中力', '表現力'],
                cost: '月額15,000円〜30,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 45分',
                traits: ['creative', 'quiet']
            },
            double_bass: {
                name: 'コントラバス',
                description: 'オーケストラの低音を支える大型弦楽器',
                category: 'music',
                icon: 'fas fa-music',
                benefits: ['音感', '責任感', '協調性', '体力向上'],
                cost: '月額10,000円〜20,000円',
                ageRange: '10歳〜18歳',
                timeCommitment: '週1回 45分',
                traits: ['creative', 'social']
            },
            viola: {
                name: 'ビオラ',
                description: 'バイオリンより低い音域の中音域弦楽器',
                category: 'music',
                icon: 'fas fa-violin',
                benefits: ['音感', '協調性', '集中力', '表現力'],
                cost: '月額10,000円〜22,000円',
                ageRange: '8歳〜18歳',
                timeCommitment: '週1回 45分',
                traits: ['creative', 'quiet']
            },
            tuba: {
                name: 'チューバ',
                description: '金管楽器の低音を担当する大型楽器',
                category: 'music',
                icon: 'fas fa-music',
                benefits: ['肺活量', '責任感', '協調性', '集中力'],
                cost: '月額10,000円〜20,000円',
                ageRange: '12歳〜18歳',
                timeCommitment: '週1回 45分',
                traits: ['creative', 'social']
            },
            french_horn: {
                name: 'フレンチホルン',
                description: '美しい音色で知られる金管楽器',
                category: 'music',
                icon: 'fas fa-music',
                benefits: ['音感', '集中力', '表現力', '協調性'],
                cost: '月額10,000円〜20,000円',
                ageRange: '10歳〜18歳',
                timeCommitment: '週1回 45分',
                traits: ['creative', 'quiet']
            },
            oboe: {
                name: 'オーボエ',
                description: '繊細で美しい音色の木管楽器',
                category: 'music',
                icon: 'fas fa-music',
                benefits: ['呼吸法', '集中力', '繊細さ', '表現力'],
                cost: '月額12,000円〜25,000円',
                ageRange: '12歳〜18歳',
                timeCommitment: '週1回 45分',
                traits: ['creative', 'quiet']
            },
            bassoon: {
                name: 'ファゴット',
                description: '木管楽器の低音を担当する大型楽器',
                category: 'music',
                icon: 'fas fa-music',
                benefits: ['呼吸法', '責任感', '協調性', '集中力'],
                cost: '月額12,000円〜25,000円',
                ageRange: '12歳〜18歳',
                timeCommitment: '週1回 45分',
                traits: ['creative', 'quiet']
            },
            percussion: {
                name: '打楽器',
                description: 'ティンパニや小太鼓などの打楽器全般',
                category: 'music',
                icon: 'fas fa-drum',
                benefits: ['リズム感', '協調性', '集中力', '表現力'],
                cost: '月額8,000円〜15,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 45分',
                traits: ['active', 'creative']
            },
            electric_guitar: {
                name: 'エレキギター',
                description: 'ロックやポップスで活躍する電子ギター',
                category: 'music',
                icon: 'fas fa-guitar',
                benefits: ['音感', '創造力', '自己表現', '技術力'],
                cost: '月額8,000円〜18,000円',
                ageRange: '10歳〜18歳',
                timeCommitment: '週1回 45分',
                traits: ['creative', 'social']
            },

            // 学習・知育系 (15種類)
            programming: {
                name: 'プログラミング',
                description: '論理的思考力と創造力を育む現代的なスキル',
                category: 'study',
                icon: 'fas fa-code',
                benefits: ['論理的思考', '創造力', '問題解決力', '将来性'],
                cost: '月額8,000円〜15,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 60分',
                traits: ['logical', 'creative']
            },
            english: {
                name: '英会話',
                description: 'グローバル社会で活躍する語学力を身につける',
                category: 'study',
                icon: 'fas fa-globe',
                benefits: ['国際的コミュニケーション', '異文化理解', '将来性', '自信向上'],
                cost: '月額6,000円〜12,000円',
                ageRange: '3歳〜18歳',
                timeCommitment: '週1回 45分',
                traits: ['social', 'logical']
            },
            abacus: {
                name: 'そろばん',
                description: '計算力と集中力を鍛える伝統的な学習法',
                category: 'study',
                icon: 'fas fa-calculator',
                benefits: ['計算力', '集中力', '記憶力', '右脳開発'],
                cost: '月額4,000円〜8,000円',
                ageRange: '5歳〜15歳',
                timeCommitment: '週2回 60分',
                traits: ['logical', 'quiet']
            },
            calligraphy: {
                name: '書道',
                description: '美しい文字と集中力を身につける日本の芸術',
                category: 'study',
                icon: 'fas fa-brush',
                benefits: ['集中力', '美的感覚', '姿勢改善', '文字の美しさ'],
                cost: '月額3,000円〜8,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 60分',
                traits: ['quiet', 'creative']
            },
            chinese: {
                name: '中国語',
                description: '将来性の高い中国語を楽しく学ぶ',
                category: 'study',
                icon: 'fas fa-language',
                benefits: ['語学力', '異文化理解', '将来性', '発音力'],
                cost: '月額6,000円〜12,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 45分',
                traits: ['social', 'logical']
            },
            robotics: {
                name: 'ロボット教室',
                description: 'ロボット製作を通じて理科と技術を学ぶ',
                category: 'study',
                icon: 'fas fa-robot',
                benefits: ['理科的思考', '創造力', '問題解決力', '手先の器用さ'],
                cost: '月額10,000円〜20,000円',
                ageRange: '6歳〜15歳',
                timeCommitment: '週1回 90分',
                traits: ['logical', 'creative']
            },
            mathematics: {
                name: '数学教室',
                description: '論理的思考力を鍛える数学の基礎学習',
                category: 'study',
                icon: 'fas fa-square-root-alt',
                benefits: ['論理的思考', '問題解決力', '集中力', '分析力'],
                cost: '月額6,000円〜15,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 60分',
                traits: ['logical', 'quiet']
            },
            science: {
                name: '科学実験教室',
                description: '実験を通じて科学の面白さを体験',
                category: 'study',
                icon: 'fas fa-flask',
                benefits: ['科学的思考', '観察力', '好奇心', '実験技術'],
                cost: '月額8,000円〜15,000円',
                ageRange: '6歳〜15歳',
                timeCommitment: '週1回 90分',
                traits: ['logical', 'creative']
            },
            reading: {
                name: '読書・国語教室',
                description: '読解力と表現力を高める国語学習',
                category: 'study',
                icon: 'fas fa-book',
                benefits: ['読解力', '表現力', '語彙力', '想像力'],
                cost: '月額5,000円〜10,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 60分',
                traits: ['quiet', 'creative']
            },
            french: {
                name: 'フランス語',
                description: '美しい響きのフランス語を学ぶ',
                category: 'study',
                icon: 'fas fa-language',
                benefits: ['語学力', '異文化理解', '美的感覚', '国際性'],
                cost: '月額6,000円〜12,000円',
                ageRange: '8歳〜18歳',
                timeCommitment: '週1回 45分',
                traits: ['social', 'creative']
            },
            korean: {
                name: '韓国語',
                description: '身近な韓国文化を通じて語学を学ぶ',
                category: 'study',
                icon: 'fas fa-language',
                benefits: ['語学力', '異文化理解', 'K-POP理解', '国際性'],
                cost: '月額5,000円〜10,000円',
                ageRange: '8歳〜18歳',
                timeCommitment: '週1回 45分',
                traits: ['social', 'creative']
            },
            spanish: {
                name: 'スペイン語',
                description: '世界で広く話されるスペイン語を学ぶ',
                category: 'study',
                icon: 'fas fa-language',
                benefits: ['語学力', '異文化理解', '国際性', '旅行力'],
                cost: '月額6,000円〜12,000円',
                ageRange: '10歳〜18歳',
                timeCommitment: '週1回 45分',
                traits: ['social', 'logical']
            },
            german: {
                name: 'ドイツ語',
                description: 'ヨーロッパの中心言語ドイツ語を学ぶ',
                category: 'study',
                icon: 'fas fa-language',
                benefits: ['語学力', '論理的思考', '文化理解', '学術性'],
                cost: '月額6,000円〜12,000円',
                ageRange: '12歳〜18歳',
                timeCommitment: '週1回 45分',
                traits: ['logical', 'quiet']
            },
            chess: {
                name: 'チェス',
                description: '戦略的思考力を鍛える世界的なボードゲーム',
                category: 'study',
                icon: 'fas fa-chess',
                benefits: ['戦略的思考', '集中力', '先読み能力', '国際性'],
                cost: '月額4,000円〜8,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['logical', 'quiet']
            },
            debate: {
                name: 'ディベート',
                description: '論理的思考と表現力を鍛える議論の技術',
                category: 'study',
                icon: 'fas fa-comments',
                benefits: ['論理的思考', '表現力', '批判的思考', 'コミュニケーション'],
                cost: '月額6,000円〜12,000円',
                ageRange: '10歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['logical', 'social']
            },

            // 芸術・創作系 (15種類)
            art_painting: {
                name: '絵画教室',
                description: '自由な発想で絵を描く創造性を育む',
                category: 'art',
                icon: 'fas fa-palette',
                benefits: ['創造力', '表現力', '集中力', '美的感覚'],
                cost: '月額5,000円〜12,000円',
                ageRange: '3歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['creative', 'quiet']
            },
            pottery: {
                name: '陶芸',
                description: '土と触れ合いながら作品を作る伝統工芸',
                category: 'art',
                icon: 'fas fa-vase',
                benefits: ['創造力', '集中力', '手先の器用さ', '忍耐力'],
                cost: '月額6,000円〜15,000円',
                ageRange: '8歳〜18歳',
                timeCommitment: '週1回 120分',
                traits: ['creative', 'quiet']
            },
            sculpture: {
                name: '彫刻',
                description: '立体造形を通じて空間認識力を育む',
                category: 'art',
                icon: 'fas fa-hammer',
                benefits: ['空間認識力', '創造力', '集中力', '手先の器用さ'],
                cost: '月額8,000円〜18,000円',
                ageRange: '10歳〜18歳',
                timeCommitment: '週1回 120分',
                traits: ['creative', 'logical']
            },
            photography: {
                name: '写真',
                description: '美しい瞬間を切り取る芸術的感性を育む',
                category: 'art',
                icon: 'fas fa-camera',
                benefits: ['美的感覚', '観察力', '創造力', 'デジタル技術'],
                cost: '月額8,000円〜20,000円',
                ageRange: '10歳〜18歳',
                timeCommitment: '週1回 120分',
                traits: ['creative', 'logical']
            },
            design: {
                name: 'デザイン',
                description: 'グラフィックデザインの基礎を学ぶ',
                category: 'art',
                icon: 'fas fa-pencil-ruler',
                benefits: ['デザイン力', '創造力', 'IT技術', '美的感覚'],
                cost: '月額10,000円〜20,000円',
                ageRange: '12歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['creative', 'logical']
            },
            handicraft: {
                name: '手芸・工作',
                description: '手先を使った創作活動で器用さを育む',
                category: 'art',
                icon: 'fas fa-cut',
                benefits: ['手先の器用さ', '創造力', '集中力', '完成の喜び'],
                cost: '月額3,000円〜8,000円',
                ageRange: '4歳〜15歳',
                timeCommitment: '週1回 90分',
                traits: ['creative', 'quiet']
            },
            origami: {
                name: '折り紙',
                description: '日本の伝統文化で集中力と手先の器用さを育む',
                category: 'art',
                icon: 'fas fa-paper-plane',
                benefits: ['手先の器用さ', '集中力', '空間認識力', '伝統文化'],
                cost: '月額2,000円〜5,000円',
                ageRange: '4歳〜15歳',
                timeCommitment: '週1回 60分',
                traits: ['quiet', 'logical']
            },
            manga: {
                name: '漫画・イラスト',
                description: 'ストーリーと絵で表現する現代的な芸術',
                category: 'art',
                icon: 'fas fa-pencil',
                benefits: ['表現力', '創造力', 'ストーリー構成', '集中力'],
                cost: '月額6,000円〜12,000円',
                ageRange: '8歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['creative', 'quiet']
            },
            watercolor: {
                name: '水彩画',
                description: '透明感のある美しい水彩画を学ぶ',
                category: 'art',
                icon: 'fas fa-palette',
                benefits: ['色彩感覚', '表現力', '集中力', '美的感覚'],
                cost: '月額5,000円〜12,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['creative', 'quiet']
            },
            oil_painting: {
                name: '油絵',
                description: '本格的な油絵で深い表現力を身につける',
                category: 'art',
                icon: 'fas fa-palette',
                benefits: ['表現力', '集中力', '技術力', '芸術性'],
                cost: '月額8,000円〜18,000円',
                ageRange: '10歳〜18歳',
                timeCommitment: '週1回 120分',
                traits: ['creative', 'quiet']
            },
            printmaking: {
                name: '版画',
                description: '版を使った独特な表現技法を学ぶ',
                category: 'art',
                icon: 'fas fa-print',
                benefits: ['技術力', '創造力', '集中力', '工芸技術'],
                cost: '月額6,000円〜15,000円',
                ageRange: '10歳〜18歳',
                timeCommitment: '週1回 120分',
                traits: ['creative', 'logical']
            },
            jewelry_making: {
                name: 'アクセサリー制作',
                description: '美しいアクセサリーを手作りで制作',
                category: 'art',
                icon: 'fas fa-gem',
                benefits: ['手先の器用さ', '美的感覚', '創造力', '集中力'],
                cost: '月額6,000円〜15,000円',
                ageRange: '8歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['creative', 'quiet']
            },
            glass_art: {
                name: 'ガラス工芸',
                description: 'ガラスを使った美しい工芸品を制作',
                category: 'art',
                icon: 'fas fa-wine-glass',
                benefits: ['技術力', '創造力', '集中力', '芸術性'],
                cost: '月額8,000円〜20,000円',
                ageRange: '12歳〜18歳',
                timeCommitment: '週1回 120分',
                traits: ['creative', 'logical']
            },
            textile_art: {
                name: '染織・テキスタイル',
                description: '布の染色や織物で表現力を育む',
                category: 'art',
                icon: 'fas fa-tshirt',
                benefits: ['色彩感覚', '創造力', '伝統技術', '手先の器用さ'],
                cost: '月額6,000円〜15,000円',
                ageRange: '8歳〜18歳',
                timeCommitment: '週1回 120分',
                traits: ['creative', 'quiet']
            },
            wood_carving: {
                name: '木工・彫刻',
                description: '木材を使った立体作品制作',
                category: 'art',
                icon: 'fas fa-hammer',
                benefits: ['技術力', '創造力', '集中力', '工芸技術'],
                cost: '月額8,000円〜18,000円',
                ageRange: '10歳〜18歳',
                timeCommitment: '週1回 120分',
                traits: ['creative', 'logical']
            },

            // ダンス・パフォーマンス系 (12種類)
            ballet: {
                name: 'バレエ',
                description: '優雅さと美しい姿勢を身につける古典舞踊',
                category: 'dance',
                icon: 'fas fa-shoe-prints',
                benefits: ['姿勢改善', '柔軟性', '表現力', '優雅さ'],
                cost: '月額8,000円〜20,000円',
                ageRange: '3歳〜18歳',
                timeCommitment: '週1回 60分',
                traits: ['creative', 'active']
            },
            jazz_dance: {
                name: 'ジャズダンス',
                description: 'リズミカルで表現豊かなモダンダンス',
                category: 'dance',
                icon: 'fas fa-music',
                benefits: ['リズム感', '表現力', '体力向上', '自信向上'],
                cost: '月額6,000円〜15,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['creative', 'active']
            },
            hip_hop: {
                name: 'ヒップホップダンス',
                description: 'かっこよく踊る現代的なストリートダンス',
                category: 'dance',
                icon: 'fas fa-headphones',
                benefits: ['リズム感', '自己表現', '体力向上', '創造力'],
                cost: '月額5,000円〜12,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['creative', 'active']
            },
            japanese_dance: {
                name: '日本舞踊',
                description: '日本の伝統文化を体現する美しい舞踊',
                category: 'dance',
                icon: 'fas fa-fan',
                benefits: ['伝統文化', '礼儀作法', '表現力', '姿勢改善'],
                cost: '月額8,000円〜20,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['creative', 'quiet']
            },
            cheerleading: {
                name: 'チアリーディング',
                description: '元気よく踊って人を応援するスポーツダンス',
                category: 'dance',
                icon: 'fas fa-pom-poms',
                benefits: ['チームワーク', '体力向上', '表現力', 'ポジティブ思考'],
                cost: '月額6,000円〜15,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週2回 90分',
                traits: ['active', 'social']
            },
            contemporary_dance: {
                name: 'コンテンポラリーダンス',
                description: '自由な表現で内面を表現するモダンダンス',
                category: 'dance',
                icon: 'fas fa-user-friends',
                benefits: ['表現力', '創造力', '柔軟性', '感情表現'],
                cost: '月額8,000円〜18,000円',
                ageRange: '8歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['creative', 'quiet']
            },
            tap_dance: {
                name: 'タップダンス',
                description: '足音でリズムを刻む楽しいダンス',
                category: 'dance',
                icon: 'fas fa-shoe-heel',
                benefits: ['リズム感', '集中力', '足腰強化', '音楽性'],
                cost: '月額6,000円〜15,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['creative', 'active']
            },
            latin_dance: {
                name: 'ラテンダンス',
                description: '情熱的でエネルギッシュな南米のダンス',
                category: 'dance',
                icon: 'fas fa-fire',
                benefits: ['表現力', '情熱', '体力向上', '国際性'],
                cost: '月額7,000円〜15,000円',
                ageRange: '8歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['creative', 'active']
            },
            breakdance: {
                name: 'ブレイクダンス',
                description: 'アクロバティックな技術を駆使するストリートダンス',
                category: 'dance',
                icon: 'fas fa-sync-alt',
                benefits: ['体力向上', '技術力', '創造力', '挑戦精神'],
                cost: '月額6,000円〜15,000円',
                ageRange: '8歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['active', 'creative']
            },
            belly_dance: {
                name: 'ベリーダンス',
                description: '中東の伝統的なダンスで体幹を鍛える',
                category: 'dance',
                icon: 'fas fa-moon',
                benefits: ['体幹強化', '柔軟性', '表現力', '異文化理解'],
                cost: '月額6,000円〜12,000円',
                ageRange: '8歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['creative', 'active']
            },
            theater: {
                name: '演劇',
                description: '演技を通じて表現力とコミュニケーション力を育む',
                category: 'performance',
                icon: 'fas fa-theater-masks',
                benefits: ['表現力', 'コミュニケーション力', '自信向上', '協調性'],
                cost: '月額6,000円〜15,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 120分',
                traits: ['creative', 'social']
            },
            musical_theater: {
                name: 'ミュージカル',
                description: '歌・踊り・演技を総合的に学ぶ舞台芸術',
                category: 'performance',
                icon: 'fas fa-star',
                benefits: ['総合表現力', '自信向上', '協調性', '舞台度胸'],
                cost: '月額10,000円〜25,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週2回 120分',
                traits: ['creative', 'social']
            },

            // 文化・教養系 (10種類)
            tea_ceremony: {
                name: '茶道',
                description: '日本の伝統文化で心を整え礼儀を学ぶ',
                category: 'culture',
                icon: 'fas fa-leaf',
                benefits: ['礼儀作法', '集中力', '伝統文化', '心の平静'],
                cost: '月額5,000円〜15,000円',
                ageRange: '8歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['quiet', 'creative']
            },
            flower_arrangement: {
                name: '華道',
                description: '花を通じて美的感覚と集中力を育む',
                category: 'culture',
                icon: 'fas fa-seedling',
                benefits: ['美的感覚', '集中力', '伝統文化', '心の豊かさ'],
                cost: '月額6,000円〜15,000円',
                ageRange: '8歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['quiet', 'creative']
            },
            go: {
                name: '囲碁',
                description: '戦略的思考力を鍛える古典的なボードゲーム',
                category: 'culture',
                icon: 'fas fa-chess',
                benefits: ['戦略的思考', '集中力', '忍耐力', '論理的思考'],
                cost: '月額3,000円〜8,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['logical', 'quiet']
            },
            shogi: {
                name: '将棋',
                description: '日本の伝統的な戦略ゲームで思考力を鍛える',
                category: 'culture',
                icon: 'fas fa-chess-king',
                benefits: ['戦略的思考', '集中力', '記憶力', '先読み能力'],
                cost: '月額3,000円〜8,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['logical', 'quiet']
            },
            cooking: {
                name: '料理教室',
                description: '食材と向き合い創造力と生活力を身につける',
                category: 'culture',
                icon: 'fas fa-utensils',
                benefits: ['生活力', '創造力', '栄養知識', '達成感'],
                cost: '月額5,000円〜12,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 120分',
                traits: ['creative', 'logical']
            },
            baking: {
                name: 'お菓子作り・パン作り',
                description: '美味しいお菓子やパンを手作りで楽しむ',
                category: 'culture',
                icon: 'fas fa-birthday-cake',
                benefits: ['創造力', '科学的理解', '達成感', '生活力'],
                cost: '月額6,000円〜12,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 120分',
                traits: ['creative', 'logical']
            },
            gardening: {
                name: 'ガーデニング',
                description: '植物を育てることで自然との触れ合いを学ぶ',
                category: 'culture',
                icon: 'fas fa-seedling',
                benefits: ['自然理解', '責任感', '観察力', '忍耐力'],
                cost: '月額4,000円〜8,000円',
                ageRange: '6歳〜18歳',
                timeCommitment: '週1回 90分',
                traits: ['quiet', 'logical']
            },
            wine_tasting: {
                name: 'ワイン・お酒の基礎知識',
                description: '大人の教養としてのお酒の知識を学ぶ',
                category: 'culture',
                icon: 'fas fa-wine-glass',
                benefits: ['教養', '味覚', '文化理解', '大人の知識'],
                cost: '月額8,000円〜20,000円',
                ageRange: '18歳〜',
                timeCommitment: '月2回 90分',
                traits: ['quiet', 'social']
            },
            etiquette: {
                name: 'マナー・エチケット',
                description: '社会人として必要な礼儀作法を身につける',
                category: 'culture',
                icon: 'fas fa-user-tie',
                benefits: ['礼儀作法', '社会性', '自信向上', 'コミュニケーション'],
                cost: '月額6,000円〜15,000円',
                ageRange: '8歳〜18歳',
                timeCommitment: '月2回 90分',
                traits: ['social', 'quiet']
            },
            meditation: {
                name: '瞑想・マインドフルネス',
                description: '心を整え集中力と平静さを育む',
                category: 'culture',
                icon: 'fas fa-om',
                benefits: ['集中力', '心の平静', 'ストレス軽減', '自己理解'],
                cost: '月額4,000円〜10,000円',
                ageRange: '8歳〜18歳',
                timeCommitment: '週1回 60分',
                traits: ['quiet', 'logical']
            }
        };

        // Categories for chart display
        var categoryLabels = {
            baby: '赤ちゃん・幼児',
            sports: 'スポーツ',
            martial_arts: '武道',
            music: '音楽',
            study: '学習',
            art: '芸術',
            dance: 'ダンス',
            performance: 'パフォーマンス',
            culture: '文化・教養'
        };

        // Enhanced scoring algorithm for 100+ activities
        function calculateActivityScores(answers) {
            debugLog('Calculating activity scores for 100+ activities...');
            
            var scores = {};
            var categoryScores = {};
            
            // Initialize scores for all activities
            Object.keys(activities).forEach(function(key) {
                scores[key] = 0;
            });
            
            // Initialize category scores
            Object.keys(categoryLabels).forEach(function(key) {
                categoryScores[key] = 0;
            });

            // Age-based scoring
            var age = answers.age;
            Object.keys(activities).forEach(function(key) {
                var activity = activities[key];
                var ageRange = activity.ageRange;
                
                // Age compatibility scoring
                if (age === '0-2' && ageRange.includes('0歳')) {
                    scores[key] += 50;
                } else if (age === '3-4' && (ageRange.includes('3歳') || ageRange.includes('4歳'))) {
                    scores[key] += 30;
                } else if (age === '5-6' && (ageRange.includes('5歳') || ageRange.includes('6歳'))) {
                    scores[key] += 30;
                } else if (age === '7-9' && (ageRange.includes('6歳') || ageRange.includes('8歳'))) {
                    scores[key] += 25;
                } else if (age === '10-12' && (ageRange.includes('10歳') || ageRange.includes('12歳'))) {
                    scores[key] += 25;
                } else if (age === '13-15' && (ageRange.includes('12歳') || ageRange.includes('15歳'))) {
                    scores[key] += 25;
                } else if (age === '16-18' && ageRange.includes('16歳')) {
                    scores[key] += 25;
                }
            });

            // Personality-based scoring
            var personality = answers.personality;
            Object.keys(activities).forEach(function(key) {
                var activity = activities[key];
                if (activity.traits && activity.traits.includes(personality)) {
                    scores[key] += 40;
                }
                
                // Additional personality bonuses
                switch (personality) {
                    case 'active':
                        if (activity.category === 'sports' || activity.category === 'martial_arts' || activity.category === 'dance') {
                            scores[key] += 20;
                        }
                        break;
                    case 'creative':
                        if (activity.category === 'art' || activity.category === 'music' || activity.category === 'dance') {
                            scores[key] += 20;
                        }
                        break;
                    case 'logical':
                        if (activity.category === 'study') {
                            scores[key] += 20;
                        }
                        break;
                    case 'social':
                        if (activity.benefits.includes('チームワーク') || activity.benefits.includes('協調性')) {
                            scores[key] += 15;
                        }
                        break;
                    case 'quiet':
                        if (activity.category === 'culture' || activity.category === 'art') {
                            scores[key] += 15;
                        }
                        break;
                    case 'baby':
                        if (activity.category === 'baby') {
                            scores[key] += 50;
                        }
                        break;
                }
            });

            // Interest-based scoring
            var interests = answers.interests;
            Object.keys(activities).forEach(function(key) {
                var activity = activities[key];
                
                switch (interests) {
                    case 'sports':
                        if (activity.category === 'sports' || activity.category === 'martial_arts') {
                            scores[key] += 50;
                        }
                        break;
                    case 'art':
                        if (activity.category === 'art' || activity.category === 'music' || activity.category === 'dance') {
                            scores[key] += 50;
                        }
                        break;
                    case 'science':
                        if (activity.category === 'study' && (key.includes('programming') || key.includes('robotics') || key.includes('science'))) {
                            scores[key] += 50;
                        }
                        break;
                    case 'language':
                        if (activity.category === 'study' && (key.includes('english') || key.includes('chinese') || key.includes('french') || key.includes('korean') || key.includes('spanish') || key.includes('german'))) {
                            scores[key] += 50;
                        }
                        break;
                    case 'performance':
                        if (activity.category === 'dance' || activity.category === 'performance' || activity.category === 'music') {
                            scores[key] += 50;
                        }
                        break;
                    case 'sensory':
                        if (activity.category === 'baby') {
                            scores[key] += 50;
                        }
                        break;
                }
            });

            // Energy level scoring
            var energy = answers.energy;
            Object.keys(activities).forEach(function(key) {
                var activity = activities[key];
                
                switch (energy) {
                    case 'high':
                    case 'medium-high':
                        if (activity.category === 'sports' || activity.category === 'martial_arts' || activity.category === 'dance') {
                            scores[key] += 30;
                        }
                        break;
                    case 'medium-low':
                    case 'low':
                        if (activity.category === 'culture' || activity.category === 'art' || (activity.category === 'study' && !key.includes('robotics'))) {
                            scores[key] += 20;
                        }
                        break;
                    case 'baby':
                        if (activity.category === 'baby') {
                            scores[key] += 30;
                        }
                        break;
                }
            });

            // Budget considerations
            var budget = answers.budget;
            Object.keys(activities).forEach(function(key) {
                var activity = activities[key];
                var cost = activity.cost;
                
                if (budget === 'low' && (cost.includes('2,000円') || cost.includes('3,000円') || cost.includes('4,000円') || cost.includes('5,000円'))) {
                    scores[key] += 15;
                } else if (budget === 'medium-low' && cost.includes('6,000円')) {
                    scores[key] += 10;
                } else if (budget === 'high' && cost.includes('20,000円')) {
                    scores[key] += 10;
                }
            });

            // Calculate category scores for chart
            Object.keys(activities).forEach(function(key) {
                var activity = activities[key];
                var category = activity.category;
                if (!categoryScores[category]) {
                    categoryScores[category] = 0;
                }
                categoryScores[category] += scores[key];
            });

            // Normalize category scores
            var maxCategoryScore = Math.max(...Object.values(categoryScores));
            if (maxCategoryScore > 0) {
                Object.keys(categoryScores).forEach(function(key) {
                    categoryScores[key] = Math.round((categoryScores[key] / maxCategoryScore) * 100);
                });
            }

            debugLog('Calculated scores for ' + Object.keys(scores).length + ' activities');
            return { activityScores: scores, categoryScores: categoryScores };
        }

        function getCategoryTopActivities(activityScores, categoryScores) {
            // Sort categories by score
            var sortedCategories = Object.keys(categoryScores)
                .sort(function(a, b) {
                    return categoryScores[b] - categoryScores[a];
                });

            var result = {};
            
            sortedCategories.forEach(function(category) {
                // Get activities for this category
                var categoryActivities = Object.keys(activities)
                    .filter(function(key) {
                        return activities[key].category === category;
                    })
                    .map(function(key) {
                        return { name: key, score: activityScores[key] };
                    })
                    .sort(function(a, b) {
                        return b.score - a.score;
                    })
                    .slice(0, 3); // Top 3 for each category

                if (categoryActivities.length > 0) {
                    result[category] = {
                        categoryScore: categoryScores[category],
                        activities: categoryActivities
                    };
                }
            });

            return result;
        }

        function getPersonalityType(answers) {
            var personality = answers.personality;
            var types = {
                'active': '活発タイプ',
                'creative': '創造タイプ',
                'logical': '思考タイプ',
                'social': '社交タイプ',
                'quiet': '集中タイプ',
                'baby': '赤ちゃんタイプ'
            };
            return types[personality] || '未分類';
        }

        // DOM manipulation functions
        function showScreen(screenId) {
            debugLog('Showing screen: ' + screenId);
            
            var screens = ['welcome-screen', 'question-screen', 'loading-screen', 'result-screen', 'history-screen'];
            screens.forEach(function(id) {
                var element = document.getElementById(id);
                if (element) {
                    element.classList.add('hidden');
                }
            });

            var targetScreen = document.getElementById(screenId);
            if (targetScreen) {
                targetScreen.classList.remove('hidden');
                targetScreen.classList.add('animate-fade-in');
            }

            // Show/hide progress bar
            var progressContainer = document.getElementById('progress-container');
            if (screenId === 'question-screen') {
                progressContainer.classList.remove('hidden');
            } else {
                progressContainer.classList.add('hidden');
            }
        }

        function updateProgress() {
            var progress = ((appState.currentQuestion + 1) / questions.length) * 100;
            var progressBar = document.getElementById('progress-bar');
            var progressText = document.getElementById('progress-text');
            
            if (progressBar) {
                progressBar.style.width = progress + '%';
            }
            if (progressText) {
                progressText.textContent = (appState.currentQuestion + 1) + '/' + questions.length;
            }
        }

        function renderQuestion() {
            var question = questions[appState.currentQuestion];
            if (!question) return;

            debugLog('Rendering question: ' + question.id);

            var titleElement = document.getElementById('question-title');
            var contentElement = document.getElementById('question-content');
            var nextBtn = document.getElementById('next-btn');
            var prevBtn = document.getElementById('prev-btn');

            if (titleElement) {
                titleElement.textContent = question.title;
            }

            if (contentElement) {
                contentElement.innerHTML = '';
                
                question.options.forEach(function(option) {
                    var optionDiv = document.createElement('div');
                    optionDiv.className = 'bg-gray-50 hover:bg-blue-50 rounded-lg p-4 cursor-pointer border-2 border-transparent transition-all';
                    
                    var input = document.createElement('input');
                    input.type = 'radio';
                    input.name = question.id;
                    input.value = option.value;
                    input.id = question.id + '_' + option.value;
                    input.className = 'mr-3';
                    
                    var label = document.createElement('label');
                    label.htmlFor = input.id;
                    label.textContent = option.label;
                    label.className = 'cursor-pointer flex-1';
                    
                    optionDiv.appendChild(input);
                    optionDiv.appendChild(label);
                    
                    // Add click handler for the entire div
                    optionDiv.addEventListener('click', function() {
                        input.checked = true;
                        updateQuestionState();
                        
                        // Visual feedback
                        var allOptions = contentElement.querySelectorAll('div');
                        allOptions.forEach(function(opt) {
                            opt.classList.remove('border-blue-500', 'bg-blue-50');
                            opt.classList.add('border-transparent');
                        });
                        optionDiv.classList.add('border-blue-500', 'bg-blue-50');
                    });
                    
                    contentElement.appendChild(optionDiv);
                });
            }

            // Update button states
            if (prevBtn) {
                if (appState.currentQuestion > 0) {
                    prevBtn.classList.remove('hidden');
                } else {
                    prevBtn.classList.add('hidden');
                }
            }

            if (nextBtn) {
                nextBtn.disabled = true;
                nextBtn.classList.add('opacity-50');
            }

            updateProgress();
        }

        function updateQuestionState() {
            var question = questions[appState.currentQuestion];
            var selectedInput = document.querySelector('input[name="' + question.id + '"]:checked');
            var nextBtn = document.getElementById('next-btn');
            
            if (selectedInput && nextBtn) {
                appState.answers[question.id] = selectedInput.value;
                nextBtn.disabled = false;
                nextBtn.classList.remove('opacity-50');
                debugLog('Answer recorded: ' + question.id + ' = ' + selectedInput.value);
            }
        }

        function nextQuestion() {
            if (appState.currentQuestion < questions.length - 1) {
                appState.currentQuestion++;
                renderQuestion();
            } else {
                // All questions answered, show loading and calculate result
                showLoading();
            }
        }

        function prevQuestion() {
            if (appState.currentQuestion > 0) {
                appState.currentQuestion--;
                renderQuestion();
                
                // Restore previous answer
                var question = questions[appState.currentQuestion];
                var previousAnswer = appState.answers[question.id];
                if (previousAnswer) {
                    var input = document.querySelector('input[value="' + previousAnswer + '"]');
                    if (input) {
                        input.checked = true;
                        input.closest('div').classList.add('border-blue-500', 'bg-blue-50');
                        updateQuestionState();
                    }
                }
            }
        }

        function showLoading() {
            showScreen('loading-screen');
            
            // Simulate calculation time
            setTimeout(function() {
                calculateResults();
            }, 2000);
        }

        function calculateResults() {
            debugLog('Calculating final results...');
            
            var scoreResults = calculateActivityScores(appState.answers);
            var categoryTopActivities = getCategoryTopActivities(scoreResults.activityScores, scoreResults.categoryScores);
            var personalityType = getPersonalityType(appState.answers);
            
            appState.result = {
                activityScores: scoreResults.activityScores,
                categoryScores: scoreResults.categoryScores,
                categoryTopActivities: categoryTopActivities,
                personalityType: personalityType,
                timestamp: new Date(),
                answers: Object.assign({}, appState.answers)
            };
            
            renderResults();
            showScreen('result-screen');
        }

        function renderResults() {
            var result = appState.result;
            if (!result) return;

            debugLog('Rendering results...');

            // Render personality result
            var personalityElement = document.getElementById('personality-result');
            if (personalityElement) {
                personalityElement.innerHTML = '<div class="text-lg"><strong>' + result.personalityType + '</strong></div><p class="mt-2 text-gray-700">お子様の性格特性に基づいて、100種類以上の習い事から最適なものをカテゴリ別にご提案します。</p>';
            }

            // Render chart with category scores
            renderChart(result.categoryScores);

            // Render category-based recommendations
            var recommendationsElement = document.getElementById('category-recommendations');
            if (recommendationsElement) {
                recommendationsElement.innerHTML = '';
                
                Object.keys(result.categoryTopActivities).forEach(function(categoryKey) {
                    var categoryData = result.categoryTopActivities[categoryKey];
                    var categoryName = categoryLabels[categoryKey] || categoryKey;
                    
                    // Create category section
                    var categorySection = document.createElement('div');
                    categorySection.className = 'mb-8';
                    
                    // Category header
                    var categoryHeader = document.createElement('div');
                    categoryHeader.className = 'category-header text-white rounded-t-lg p-4';
                    categoryHeader.innerHTML = 
                        '<h4 class="text-xl font-bold flex items-center justify-between">' +
                        '<span><i class="fas fa-trophy mr-2"></i>' + categoryName + '</span>' +
                        '<span class="text-sm opacity-90">適性スコア: ' + categoryData.categoryScore + '点</span>' +
                        '</h4>';
                    
                    // Activities grid
                    var activitiesGrid = document.createElement('div');
                    activitiesGrid.className = 'grid md:grid-cols-3 gap-4 bg-gray-50 rounded-b-lg p-4';
                    
                    categoryData.activities.forEach(function(activityData, index) {
                        var activity = activities[activityData.name];
                        if (!activity) return;
                        
                        var rank = index + 1;
                        var activityCard = document.createElement('div');
                        activityCard.className = 'activity-card bg-white rounded-lg p-4 shadow-md';
                        
                        // Different medal colors for ranks
                        var medalIcon = 'fas fa-medal';
                        var medalColor = 'text-yellow-500';
                        if (rank === 2) medalColor = 'text-gray-400';
                        else if (rank === 3) medalColor = 'text-yellow-600';
                        
                        activityCard.innerHTML = 
                            '<div class="flex items-start justify-between mb-3">' +
                            '<div class="flex items-center">' +
                            '<i class="' + medalIcon + ' ' + medalColor + ' text-lg mr-2"></i>' +
                            '<span class="font-bold text-lg">' + rank + '位</span>' +
                            '</div>' +
                            '<i class="' + activity.icon + ' text-2xl text-blue-500"></i>' +
                            '</div>' +
                            '<h5 class="text-lg font-bold mb-2 text-gray-800">' + activity.name + '</h5>' +
                            '<p class="text-sm text-gray-600 mb-3">' + activity.description + '</p>' +
                            '<div class="space-y-1 text-xs text-gray-500 mb-3">' +
                            '<div><i class="fas fa-yen-sign mr-1"></i>' + activity.cost + '</div>' +
                            '<div><i class="fas fa-clock mr-1"></i>' + activity.timeCommitment + '</div>' +
                            '<div><i class="fas fa-users mr-1"></i>' + activity.ageRange + '</div>' +
                            '</div>' +
                            '<div class="text-xs text-center bg-blue-100 rounded p-2">' +
                            '<span class="font-medium text-blue-800">スコア: ' + activityData.score + '点</span>' +
                            '</div>';
                        
                        activitiesGrid.appendChild(activityCard);
                    });
                    
                    categorySection.appendChild(categoryHeader);
                    categorySection.appendChild(activitiesGrid);
                    recommendationsElement.appendChild(categorySection);
                });
            }
        }

        function renderChart(categoryScores) {
            var ctx = document.getElementById('aptitude-chart');
            if (!ctx) return;
            
            var labels = Object.keys(categoryScores).map(function(key) {
                return categoryLabels[key] || key;
            });
            var data = Object.values(categoryScores);
            
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '適性スコア',
                        data: data,
                        backgroundColor: 'rgba(99, 102, 241, 0.2)',
                        borderColor: 'rgba(99, 102, 241, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(99, 102, 241, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(99, 102, 241, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        function saveResult() {
            var result = appState.result;
            if (!result) return;
            
            try {
                var history = JSON.parse(localStorage.getItem('activityHistory') || '[]');
                history.unshift(result);
                if (history.length > 10) {
                    history = history.slice(0, 10); // Keep only last 10 results
                }
                localStorage.setItem('activityHistory', JSON.stringify(history));
                
                alert('診断結果を保存しました！');
                debugLog('Result saved to localStorage');
            } catch (error) {
                debugLog('Error saving result: ' + error.message);
                alert('保存に失敗しました。ブラウザの設定をご確認ください。');
            }
        }

        function shareResult() {
            if (!navigator.share) {
                alert('お使いのブラウザではシェア機能が利用できません。');
                return;
            }

            const result = appState.result;
            if (!result) return;

            // Get top category
            const topCategory = Object.keys(result.categoryTopActivities)[0];
            const topCategoryName = categoryLabels[topCategory] || topCategory;
            const topActivity = result.categoryTopActivities[topCategory].activities[0];
            const activityName = activities[topActivity.name] ? activities[topActivity.name].name : topActivity.name;
            
            const shareText = `【子供の習い事診断結果】\n\n最適なカテゴリ：${topCategoryName}\nおすすめ習い事：${activityName}\n性格タイプ：${result.personalityType}\n\n100種類以上から最適な習い事を診断！\nhttps://appadaycreator.github.io/kids-activity-finder/`;

            navigator.share({
                title: '子供の習い事診断結果',
                text: shareText,
                url: 'https://appadaycreator.github.io/kids-activity-finder/'
            })
            .then(() => {
                debugLog('Share successful');
            })
            .catch((error) => {
                debugLog('Share failed: ' + error);
                alert('シェアに失敗しました。');
            });
        }

        function showHistory() {
            try {
                var history = JSON.parse(localStorage.getItem('activityHistory') || '[]');
                var historyContent = document.getElementById('history-content');
                
                if (historyContent) {
                    if (history.length === 0) {
                        historyContent.innerHTML = '<p class="text-gray-600 text-center py-8">まだ診断履歴がありません。</p>';
                    } else {
                        historyContent.innerHTML = '';
                        
                        history.forEach(function(item, index) {
                            var date = new Date(item.timestamp);
                            var dateStr = date.getFullYear() + '/' + (date.getMonth() + 1) + '/' + date.getDate() + ' ' + 
                                         date.getHours() + ':' + ('0' + date.getMinutes()).slice(-2);
                            
                            var historyItem = document.createElement('div');
                            historyItem.className = 'bg-gray-50 rounded-lg p-4 mb-4';
                            
                            // Get top category and activities
                            var topCategories = Object.keys(item.categoryTopActivities || {}).slice(0, 3);
                            var topActivitiesText = topCategories.map(function(cat) {
                                var categoryName = categoryLabels[cat] || cat;
                                var topActivity = item.categoryTopActivities[cat].activities[0];
                                var activityName = activities[topActivity.name] ? activities[topActivity.name].name : topActivity.name;
                                return categoryName + ': ' + activityName;
                            }).join(', ');
                            
                            historyItem.innerHTML = 
                                '<div class="flex justify-between items-start mb-2">' +
                                '<h4 class="font-bold">診断結果 #' + (index + 1) + '</h4>' +
                                '<span class="text-sm text-gray-500">' + dateStr + '</span>' +
                                '</div>' +
                                '<p class="text-sm text-gray-600 mb-2">性格タイプ: ' + item.personalityType + '</p>' +
                                '<div class="text-sm">' +
                                '<strong>TOP3カテゴリ:</strong><br>' + topActivitiesText +
                                '</div>';
                            
                            historyContent.appendChild(historyItem);
                        });
                    }
                }
                
                showScreen('history-screen');
            } catch (error) {
                debugLog('Error loading history: ' + error.message);
                alert('履歴の読み込みに失敗しました。');
            }
        }

        function resetDiagnosis() {
            debugLog('Resetting diagnosis...');
            
            appState.currentQuestion = 0;
            appState.answers = {};
            appState.result = null;
            appState.startTime = new Date();
            
            showScreen('welcome-screen');
        }

        // Event listeners
        function initializeEventListeners() {
            debugLog('Initializing event listeners...');
            
            var startBtn = document.getElementById('start-btn');
            if (startBtn) {
                startBtn.addEventListener('click', function() {
                    debugLog('Start button clicked');
                    appState.startTime = new Date();
                    showScreen('question-screen');
                    renderQuestion();
                });
            }

            var nextBtn = document.getElementById('next-btn');
            if (nextBtn) {
                nextBtn.addEventListener('click', function() {
                    debugLog('Next button clicked');
                    nextQuestion();
                });
            }

            var prevBtn = document.getElementById('prev-btn');
            if (prevBtn) {
                prevBtn.addEventListener('click', function() {
                    debugLog('Previous button clicked');
                    prevQuestion();
                });
            }

            var shareBtn = document.getElementById('share-btn');
            if (shareBtn) {
                shareBtn.addEventListener('click', function() {
                    debugLog('Share button clicked');
                    shareResult();
                });
            }

            var saveBtn = document.getElementById('save-btn');
            if (saveBtn) {
                saveBtn.addEventListener('click', function() {
                    debugLog('Save button clicked');
                    saveResult();
                });
            }

            var compareBtn = document.getElementById('compare-btn');
            if (compareBtn) {
                compareBtn.addEventListener('click', function() {
                    debugLog('Compare button clicked');
                    showHistory();
                });
            }

            var retryBtn = document.getElementById('retry-btn');
            if (retryBtn) {
                retryBtn.addEventListener('click', function() {
                    debugLog('Retry button clicked');
                    resetDiagnosis();
                });
            }

            var backToResultBtn = document.getElementById('back-to-result-btn');
            if (backToResultBtn) {
                backToResultBtn.addEventListener('click', function() {
                    debugLog('Back to result button clicked');
                    showScreen('result-screen');
                });
            }

            debugLog('Event listeners initialized');
        }

        // Initialize application
        function initializeApp() {
            debugLog('Initializing application...');
            
            try {
                initializeEventListeners();
                
                // Initialize state
                appState.startTime = new Date();
                
                debugLog('Application initialized successfully with ' + Object.keys(activities).length + ' activities');
            } catch (error) {
                debugLog('Error initializing application: ' + error.message);
                console.error('Application initialization error:', error);
            }
        }

        // Start the application when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }

        // Service Worker registration for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        debugLog('SW registered successfully');
                    })
                    .catch(function(registrationError) {
                        debugLog('SW registration failed: ' + registrationError);
                    });
            });
        }

        debugLog('Script loaded successfully with ' + Object.keys(activities).length + ' activities in database');
    </script>
</body>
</html>